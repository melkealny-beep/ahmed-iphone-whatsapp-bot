"""
ุจูุช ูุงุชุณุงุจ ููุญู ุฃุญูุฏ ุงูุตุนูุฏู - ูุชุฎุตุต ูู ุงูุฃููููุงุช ูุงูุณุณูุงุฑุงุชูุง
WhatsApp Bot for Ahmed Al-Saidi's iPhone Store
"""

from flask import Flask, request
from twilio.twiml.messaging_response import MessagingResponse
from twilio.rest import Client
import os
from datetime import datetime

app = Flask(__name__)

# ูุนูููุงุช ุงููุญู
STORE_INFO = {
    'name': 'ูุญู ุฃุญูุฏ ุงูุตุนูุฏู ููููุจุงููุงุช',
    'specialty': 'ูุชุฎุตุตูู ูู ุงูุฃููููุงุช ุงูุฃุตููุฉ ูุงูุณุณูุงุฑุงุชูุง',
    'working_hours': 'ูู ุงูุณุจุช ููุฎููุณ: 10 ุตุจุงุญุงู - 10 ูุณุงุกู',
    'location': 'ูุฑุฌู ุชุญุฏูุซ ุงูุนููุงู ููุง',
    'phone': 'ูุฑุฌู ุชุญุฏูุซ ุฑูู ุงููุงุชู',
    'whatsapp': 'ูุฑุฌู ุชุญุฏูุซ ุฑูู ุงููุงุชุณุงุจ'
}

# ูุงุฆูุฉ ุงูููุชุฌุงุช - ุงูุฃููููุงุช
IPHONES = {
    '1': {
        'name': 'iPhone 16 Pro Max',
        'storage': ['256GB', '512GB', '1TB'],
        'colors': ['ุชูุชุงูููู ุทุจูุนู', 'ุชูุชุงูููู ุฃุจูุถ', 'ุชูุชุงูููู ุฃุณูุฏ', 'ุชูุชุงูููู ุตุญุฑุงูู'],
        'price_256': '50,000 ุฌููู',
        'price_512': '56,000 ุฌููู',
        'price_1tb': '62,000 ุฌููู',
        'features': 'ุดุงุดุฉ 6.9 ุจูุตุฉุ ูุนุงูุฌ A18 Proุ ูุงููุฑุง 48 ููุฌุง ุจูุณู'
    },
    '2': {
        'name': 'iPhone 16 Pro',
        'storage': ['128GB', '256GB', '512GB', '1TB'],
        'colors': ['ุชูุชุงูููู ุทุจูุนู', 'ุชูุชุงูููู ุฃุจูุถ', 'ุชูุชุงูููู ุฃุณูุฏ', 'ุชูุชุงูููู ุตุญุฑุงูู'],
        'price_128': '42,000 ุฌููู',
        'price_256': '46,000 ุฌููู',
        'price_512': '52,000 ุฌููู',
        'price_1tb': '58,000 ุฌููู',
        'features': 'ุดุงุดุฉ 6.3 ุจูุตุฉุ ูุนุงูุฌ A18 Proุ ูุงููุฑุง 48 ููุฌุง ุจูุณู'
    },
    '3': {
        'name': 'iPhone 16 Plus',
        'storage': ['128GB', '256GB', '512GB'],
        'colors': ['ุฃุณูุฏ', 'ุฃุจูุถ', 'ูุฑุฏู', 'ุฃุฒุฑู ูุงุชุญ', 'ุฃุฎุถุฑ ูุงุชุญ'],
        'price_128': '36,000 ุฌููู',
        'price_256': '40,000 ุฌููู',
        'price_512': '46,000 ุฌููู',
        'features': 'ุดุงุดุฉ 6.7 ุจูุตุฉุ ูุนุงูุฌ A18ุ ูุงููุฑุง 48 ููุฌุง ุจูุณู'
    },
    '4': {
        'name': 'iPhone 16',
        'storage': ['128GB', '256GB', '512GB'],
        'colors': ['ุฃุณูุฏ', 'ุฃุจูุถ', 'ูุฑุฏู', 'ุฃุฒุฑู ูุงุชุญ', 'ุฃุฎุถุฑ ูุงุชุญ'],
        'price_128': '32,000 ุฌููู',
        'price_256': '36,000 ุฌููู',
        'price_512': '42,000 ุฌููู',
        'features': 'ุดุงุดุฉ 6.1 ุจูุตุฉุ ูุนุงูุฌ A18ุ ูุงููุฑุง 48 ููุฌุง ุจูุณู'
    },
    '5': {
        'name': 'iPhone 15 Pro Max',
        'storage': ['256GB', '512GB', '1TB'],
        'colors': ['ุชูุชุงูููู ุทุจูุนู', 'ุชูุชุงูููู ุฃุฒุฑู', 'ุชูุชุงูููู ุฃุจูุถ', 'ุชูุชุงูููู ุฃุณูุฏ'],
        'price_256': '42,000 ุฌููู',
        'price_512': '47,000 ุฌููู',
        'price_1tb': '53,000 ุฌููู',
        'features': 'ุดุงุดุฉ 6.7 ุจูุตุฉุ ูุนุงูุฌ A17 Proุ ูุงููุฑุง 48 ููุฌุง ุจูุณู'
    },
    '6': {
        'name': 'iPhone 15',
        'storage': ['128GB', '256GB', '512GB'],
        'colors': ['ุฃุณูุฏ', 'ุฃุฒุฑู', 'ุฃุฎุถุฑ', 'ูุฑุฏู', 'ุฃุตูุฑ'],
        'price_128': '28,000 ุฌููู',
        'price_256': '32,000 ุฌููู',
        'price_512': '37,000 ุฌููู',
        'features': 'ุดุงุดุฉ 6.1 ุจูุตุฉุ ูุนุงูุฌ A16 Bionicุ ูุงููุฑุง 48 ููุฌุง ุจูุณู'
    },
    '7': {
        'name': 'iPhone 14',
        'storage': ['128GB', '256GB', '512GB'],
        'colors': ['ุฃุฒุฑู', 'ุจููุณุฌู', 'ุฃุญูุฑ', 'ุฃุจูุถ ูุฌูู', 'ููุชุตู ุงูููู'],
        'price_128': '24,000 ุฌููู',
        'price_256': '28,000 ุฌููู',
        'price_512': '33,000 ุฌููู',
        'features': 'ุดุงุดุฉ 6.1 ุจูุตุฉุ ูุนุงูุฌ A15 Bionic'
    },
    '8': {
        'name': 'iPhone 13',
        'storage': ['128GB', '256GB', '512GB'],
        'colors': ['ูุฑุฏู', 'ุฃุฒุฑู', 'ููุชุตู ุงูููู', 'ุฃุจูุถ ูุฌูู', 'ุฃุญูุฑ', 'ุฃุฎุถุฑ'],
        'price_128': '20,000 ุฌููู',
        'price_256': '24,000 ุฌููู',
        'price_512': '29,000 ุฌููู',
        'features': 'ุดุงุดุฉ 6.1 ุจูุตุฉุ ูุนุงูุฌ A15 Bionic'
    }
}

# ุงูุงูุณุณูุงุฑุงุช
ACCESSORIES = {
    '1': {'name': 'ุณูุงุนุงุช AirPods Pro 2', 'price': '8,500 ุฌููู', 'desc': 'ุฅูุบุงุก ุงูุถูุถุงุก ุงููุดุทุ ููุงููุฉ ูููุงุก'},
    '2': {'name': 'ุณูุงุนุงุช AirPods 3', 'price': '6,000 ุฌููู', 'desc': 'ุตูุช ููุงููุ ููุงููุฉ ูููุงุก ูุงูุนุฑู'},
    '3': {'name': 'Apple Watch Series 10', 'price': '15,000 ุฌููู', 'desc': 'GPSุ ุดุงุดุฉ Retina ุฏุงุฆูุฉ ุงูุชุดุบูู'},
    '4': {'name': 'ุดุงุญู MagSafe', 'price': '1,800 ุฌููู', 'desc': 'ุดุญู ูุงุณููู ุณุฑูุน 15 ูุงุท'},
    '5': {'name': 'ููุฑ ุณูููููู ุฃุตูู', 'price': '1,200 ุฌููู', 'desc': 'ุญูุงูุฉ ูุงููุฉุ ุฃููุงู ูุชุนุฏุฏุฉ'},
    '6': {'name': 'ููุฑ ุฌูุฏ ุฃุตูู', 'price': '2,000 ุฌููู', 'desc': 'ุฌูุฏ ุทุจูุนู ูุงุฎุฑุ ุญูุงูุฉ ููุชุงุฒุฉ'},
    '7': {'name': 'ูุงูู ุดุงุดุฉ ุฒุฌุงุฌู', 'price': '300 ุฌููู', 'desc': 'ุญูุงูุฉ 9Hุ ุดูุงู ุชูุงูุงู'},
    '8': {'name': 'ูุงุจู Lightning ุฃุตูู', 'price': '800 ุฌููู', 'desc': 'ูุงุจู 1 ูุชุฑุ ุถูุงู ุฃุจู'},
    '9': {'name': 'ูุงุจู USB-C ุฃุตูู', 'price': '900 ุฌููู', 'desc': 'ูุงุจู 1 ูุชุฑ ููุดุญู ุงูุณุฑูุน'},
    '10': {'name': 'ูุญูู Lightning to 3.5mm', 'price': '500 ุฌููู', 'desc': 'ููุณูุงุนุงุช ุงูุณูููุฉ'}
}

# ุญุงูุฉ ุงููุญุงุฏุซุฉ ููู ูุณุชุฎุฏู
user_sessions = {}

def get_main_menu():
    """ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ"""
    menu = f"""
๐ *ุฃููุงู ูุณููุงู ูู {STORE_INFO['name']}* ๐

{STORE_INFO['specialty']}

๐ฑ *ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ:*

1๏ธโฃ ุนุฑุถ ุงูุฃููููุงุช ุงููุชุงุญุฉ
2๏ธโฃ ุนุฑุถ ุงูุงูุณุณูุงุฑุงุช
3๏ธโฃ ุงูุงุณุชูุณุงุฑ ุนู ููุชุฌ ูุนูู
4๏ธโฃ ูุนูููุงุช ุงูุชูุงุตู ูุงููููุน
5๏ธโฃ ุณุงุนุงุช ุงูุนูู
6๏ธโฃ ุงูุนุฑูุถ ุงูุญุงููุฉ
7๏ธโฃ ุทูุจ ุฌูุงุฒ ูุนูู

๐ *ุงูุชุจ ุฑูู ุงูุงุฎุชูุงุฑ ุฃู ุงุณุฃู ุฃู ุณุคุงู*
"""
    return menu

def show_iphones():
    """ุนุฑุถ ูุงุฆูุฉ ุงูุฃููููุงุช"""
    message = "๐ฑ *ุงูุฃููููุงุช ุงููุชุงุญุฉ:*\n\n"
    for key, iphone in IPHONES.items():
        message += f"{key}. *{iphone['name']}*\n"
        message += f"   ๐พ ุงููุณุงุญุงุช: {', '.join(iphone['storage'])}\n"
        # ุนุฑุถ ุงูุณุนุฑ ุงูุฃุณุงุณู
        if 'price_128' in iphone:
            message += f"   ๐ฐ ูุจุฏุฃ ูู: {iphone['price_128']}\n"
        elif 'price_256' in iphone:
            message += f"   ๐ฐ ูุจุฏุฃ ูู: {iphone['price_256']}\n"
        message += "\n"
    
    message += "\n๐ *ุงูุชุจ ุฑูู ุงูุฌูุงุฒ ููุนุฑูุฉ ุงูุชูุงุตูู*"
    message += "\n๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ ูููุงุฆูุฉ ุงูุฑุฆูุณูุฉ"
    return message

def show_iphone_details(iphone_id):
    """ุนุฑุถ ุชูุงุตูู ุฃูููู ูุนูู"""
    if iphone_id not in IPHONES:
        return "โ ุฑูู ุบูุฑ ุตุญูุญ. ุงูุชุจ 'ุงูุฃููููุงุช' ูุนุฑุถ ุงููุงุฆูุฉ ูุฑุฉ ุฃุฎุฑู."
    
    iphone = IPHONES[iphone_id]
    message = f"๐ฑ *{iphone['name']}*\n\n"
    message += f"โจ *ุงูููุงุตูุงุช:*\n{iphone['features']}\n\n"
    
    message += f"๐จ *ุงูุฃููุงู ุงููุชุงุญุฉ:*\n"
    for color in iphone['colors']:
        message += f"   โข {color}\n"
    
    message += f"\n๐ฐ *ุงูุฃุณุนุงุฑ:*\n"
    for key, value in iphone.items():
        if key.startswith('price_'):
            storage = key.replace('price_', '').upper()
            if storage == '1TB':
                storage = '1TB'
            message += f"   โข {storage}: {value}\n"
    
    message += "\nโ *ุฌููุน ุงูุฃุฌูุฒุฉ ุฃุตููุฉ 100% ุจุถูุงู ุฃุจู*"
    message += "\n๐ณ *ููุจู ุฌููุน ูุณุงุฆู ุงูุฏูุน*"
    message += "\n\n๐ ุงูุชุจ 'ุทูุจ' ูุทูุจ ูุฐุง ุงูุฌูุงุฒ"
    message += "\n๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ"
    return message

def show_accessories():
    """ุนุฑุถ ุงูุงูุณุณูุงุฑุงุช"""
    message = "๐ง *ุงูุงูุณุณูุงุฑุงุช ุงููุชุงุญุฉ:*\n\n"
    for key, acc in ACCESSORIES.items():
        message += f"{key}. *{acc['name']}*\n"
        message += f"   ๐ฐ ุงูุณุนุฑ: {acc['price']}\n"
        message += f"   โน๏ธ {acc['desc']}\n\n"
    
    message += "\n๐ *ุงูุชุจ ุฑูู ุงูุงูุณุณูุงุฑ ููุทูุจ*"
    message += "\n๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ"
    return message

def show_contact_info():
    """ุนุฑุถ ูุนูููุงุช ุงูุชูุงุตู"""
    message = f"""
๐ *ูุนูููุงุช ุงูุชูุงุตู:*

๐ช *ุงูุนููุงู:* {STORE_INFO['location']}
๐ *ุงููุงุชู:* {STORE_INFO['phone']}
๐ฌ *ูุงุชุณุงุจ:* {STORE_INFO['whatsapp']}

๐ *ุณุงุนุงุช ุงูุนูู:*
{STORE_INFO['working_hours']}

๐ *ูููู ุงูุชูุตูู ูุฌููุน ุงููุญุงูุธุงุช*
๐ณ *ููุจู ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู*

๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ
"""
    return message

def show_offers():
    """ุนุฑุถ ุงูุนุฑูุถ ุงูุญุงููุฉ"""
    message = """
๐ *ุงูุนุฑูุถ ุงูุญุงููุฉ:*

๐ฅ *ุนุฑุถ ุงูุฃุณุจูุน:*
   โข ุฎุตู 5% ุนูู ุฌููุน ุงูุฃููููุงุช ุงูููุฏู
   โข ูุฏูุฉ ูุฌุงููุฉ ูุน ูู ุฌูุงุฒ (ููุฑ + ูุงูู ุดุงุดุฉ)
   
๐ *ุนุฑุถ ุงูุงูุณุณูุงุฑุงุช:*
   โข ุนูุฏ ุดุฑุงุก 3 ุงูุณุณูุงุฑุงุช ุงุญุตู ุนูู ุฎุตู 10%
   
๐ *ุนุฑุถ ุงูุชุจุฏูู:*
   โข ูุณุชุจุฏู ุฌูุงุฒู ุงููุฏูู ุจุฃูุถู ุณุนุฑ
   
๐ฑ *ุงุชุตู ุจูุง ูููุฒูุฏ ูู ุงูุชูุงุตูู*

๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ
"""
    return message

def process_order(user_message):
    """ูุนุงูุฌุฉ ุงูุทูุจ"""
    message = """
โ *ุชู ุงุณุชูุงู ุทูุจู!*

ุณูุชูุงุตู ูุนู ุฃุญุฏ ููุซูููุง ุฎูุงู ุฏูุงุฆู ูุชุฃููุฏ ุงูุทูุจ ูุชูุงุตูู ุงูุชูุตูู.

๐ *ูุนูููุงุช ูุทููุจุฉ:*
   โข ุงูุงุณู ุจุงููุงูู
   โข ุฑูู ุงููุงุชู
   โข ุงูุนููุงู ุจุงูุชูุตูู
   โข ุทุฑููุฉ ุงูุฏูุน ุงูููุถูุฉ

๐ ุฃู ููููู ุงูุงุชุตุงู ูุจุงุดุฑุฉ ุนูู:
{STORE_INFO['phone']}

ุดูุฑุงู ูุซูุชู ูู ูุญู ุฃุญูุฏ ุงูุตุนูุฏู! ๐

๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ
"""
    return message

def handle_message(user_message):
    """ูุนุงูุฌุฉ ุฑุณุงูุฉ ุงููุณุชุฎุฏู"""
    user_message = user_message.strip()
    user_message_lower = user_message.lower()
    
    # ุงูุฑุฏ ุนูู ุงูุชุญูุงุช
    greetings = ['ุงูุณูุงู', 'ูุฑุญุจุง', 'ุงููุง', 'ุตุจุงุญ', 'ูุณุงุก', 'ูุงู', 'ููู', 'hello', 'hi']
    if any(greeting in user_message_lower for greeting in greetings):
        return f"ูุนูููู ุงูุณูุงู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชู ๐\n\n{get_main_menu()}"
    
    # ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ
    if any(word in user_message_lower for word in ['ูุงุฆูุฉ', 'menu', 'ุจุฏุงูุฉ', 'start']):
        return get_main_menu()
    
    # ุนุฑุถ ุงูุฃููููุงุช
    if user_message == '1' or any(word in user_message_lower for word in ['ุงูููู', 'iphone', 'ุฃูููู', 'ุฌูุงุฒ', 'ููุจุงูู']):
        return show_iphones()
    
    # ุชูุงุตูู ุฃูููู ูุนูู
    if user_message in IPHONES:
        return show_iphone_details(user_message)
    
    # ุนุฑุถ ุงูุงูุณุณูุงุฑุงุช
    if user_message == '2' or any(word in user_message_lower for word in ['ุงูุณุณูุงุฑ', 'accessory', 'ุณูุงุนุงุช', 'ููุฑ', 'ุดุงุญู']):
        return show_accessories()
    
    # ุงูุงุณุชูุณุงุฑ
    if user_message == '3' or any(word in user_message_lower for word in ['ุงุณุชูุณุงุฑ', 'ุณุคุงู', 'ุงุณุชูุณุฑ']):
        return """
โ *ุชูุถู ุจุงุณุชูุณุงุฑู*

ููููู ุงูุณุคุงู ุนู:
   โข ุฃุณุนุงุฑ ุงูุฃุฌูุฒุฉ
   โข ุชููุฑ ููุฏูู ูุนูู
   โข ุงูููุงุตูุงุช ุงูุชูููุฉ
   โข ุทุฑู ุงูุฏูุน
   โข ุงูุชูุตูู
   โข ุงูุถูุงู
   โข ุงูุชุจุฏูู

๐ฌ ุงูุชุจ ุงุณุชูุณุงุฑู ูุณูุฑุฏ ุนููู ููุฑุงู
"""
    
    # ูุนูููุงุช ุงูุชูุงุตู
    if user_message == '4' or any(word in user_message_lower for word in ['ูููุน', 'ุนููุงู', 'ุชูุงุตู', 'location', 'address']):
        return show_contact_info()
    
    # ุณุงุนุงุช ุงูุนูู
    if user_message == '5' or any(word in user_message_lower for word in ['ุณุงุนุงุช', 'ููุงุนูุฏ', 'ุฏูุงู']):
        return f"""
๐ *ุณุงุนุงุช ุงูุนูู:*

{STORE_INFO['working_hours']}

๐ *ููุชูุญ ุทูุงู ุงูุฃุณุจูุน ูุฎุฏูุชู*

๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ
"""
    
    # ุงูุนุฑูุถ
    if user_message == '6' or any(word in user_message_lower for word in ['ุนุฑุถ', 'ุนุฑูุถ', 'ุฎุตู', 'ุชุฎููุถ', 'offer']):
        return show_offers()
    
    # ุทูุจ ุฌูุงุฒ
    if user_message == '7' or any(word in user_message_lower for word in ['ุทูุจ', 'ุงุทูุจ', 'ุดุฑุงุก', 'order']):
        return process_order(user_message)
    
    # ุงูุฑุฏ ุนูู ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ
    if any(word in user_message_lower for word in ['ุถูุงู', 'guarantee', 'warranty']):
        return """
โ *ุงูุถูุงู:*

ุฌููุน ุฃุฌูุฒุชูุง ุชุฃุชู ูุน:
   โข ุถูุงู ุฃุจู ุงูุฏููู ููุฏุฉ ุณูุฉ
   โข ูุงุชูุฑุฉ ุฑุณููุฉ
   โข ุตูุงูุฉ ูุนุชูุฏุฉ ูู ุฃุจู

๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ
"""
    
    if any(word in user_message_lower for word in ['ุชูุตูู', 'ุดุญู', 'delivery']):
        return """
๐ *ุงูุชูุตูู:*

   โข ุชูุตูู ูุฌููุน ุฃูุญุงุก ูุตุฑ
   โข ุงูุดุญู ุฎูุงู 24-48 ุณุงุนุฉ
   โข ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู ูุชุงุญ
   โข ุดุญู ูุฌุงูู ูููุงูุฑุฉ ูุงูุฌูุฒุฉ
   โข ุฑุณูู ุชูุตูู ุฑูุฒูุฉ ูููุญุงูุธุงุช

๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ
"""
    
    if any(word in user_message_lower for word in ['ุฏูุน', 'payment', 'ููุฒุง', 'ูุงุด']):
        return """
๐ณ *ุทุฑู ุงูุฏูุน:*

ููุจู ุฌููุน ุทุฑู ุงูุฏูุน:
   โข ูุงุด ุนูุฏ ุงูุงุณุชูุงู
   โข ููุฒุง / ูุงุณุชุฑูุงุฑุฏ
   โข ููุฏุงููู ูุงุด
   โข ุงูุณุชุงุจุงู
   โข ุชูุณูุท (ุญุณุจ ุงูุจูู)

๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ
"""
    
    if any(word in user_message_lower for word in ['ุชุจุฏูู', 'ุงุณุชุจุฏุงู', 'trade']):
        return """
๐ *ุงูุชุจุฏูู:*

ูุณุชุจุฏู ุฌูุงุฒู ุงููุฏูู ุจุฃูุถู ุณุนุฑ!

โจ ุงููููุฒุงุช:
   โข ุชูููู ููุฑู ูุฌูุงุฒู
   โข ุฃูุถู ุณุนุฑ ูู ุงูุณูู
   โข ุณุฑุนุฉ ูู ุงูุฅุฌุฑุงุกุงุช
   โข ููุจู ุฌููุน ุงูููุฏููุงุช

๐ฑ ุงุชุตู ุจูุง ููุนุฑูุฉ ูููุฉ ุฌูุงุฒู

๐ ุงูุชุจ 'ุงููุงุฆูุฉ' ููุนูุฏุฉ
"""
    
    # ุฑุฏ ุงูุชุฑุงุถู ููุฑุณุงุฆู ุบูุฑ ุงููููููุฉ
    return f"""
ุนุฐุฑุงูุ ูู ุฃููู ุทูุจู ุฌูุฏุงู ๐

{get_main_menu()}

ุฃู ููููู ุงูุงุชุตุงู ุจูุง ูุจุงุดุฑุฉ ุนูู:
๐ {STORE_INFO['phone']}
"""

@app.route('/webhook', methods=['POST'])
def webhook():
    """ูุนุงูุฌุฉ ุฑุณุงุฆู ุงููุงุชุณุงุจ"""
    incoming_msg = request.values.get('Body', '').strip()
    sender = request.values.get('From', '')
    
    # ูุนุงูุฌุฉ ุงูุฑุณุงูุฉ
    response_text = handle_message(incoming_msg)
    
    # ุฅุฑุณุงู ุงูุฑุฏ
    resp = MessagingResponse()
    msg = resp.message()
    msg.body(response_text)
    
    return str(resp)

@app.route('/', methods=['GET'])
def home():
    """ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ"""
    return """
    <html>
        <head>
            <title>ุจูุช ูุงุชุณุงุจ - ูุญู ุฃุญูุฏ ุงูุตุนูุฏู</title>
            <meta charset="utf-8">
            <style>
                body {
                    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    text-align: center;
                    padding: 50px;
                    direction: rtl;
                }
                .container {
                    background: rgba(255, 255, 255, 0.1);
                    backdrop-filter: blur(10px);
                    border-radius: 20px;
                    padding: 40px;
                    max-width: 600px;
                    margin: 0 auto;
                    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
                }
                h1 {
                    font-size: 2.5em;
                    margin-bottom: 20px;
                }
                .status {
                    background: #4CAF50;
                    padding: 15px;
                    border-radius: 10px;
                    margin: 20px 0;
                    font-size: 1.2em;
                }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>๐ค ุจูุช ูุงุชุณุงุจ</h1>
                <h2>ูุญู ุฃุญูุฏ ุงูุตุนูุฏู ููููุจุงููุงุช</h2>
                <div class="status">
                    โ ุงูุจูุช ูุนูู ุจูุฌุงุญ!
                </div>
                <p>ูุชุฎุตุตูู ูู ุงูุฃููููุงุช ุงูุฃุตููุฉ ูุงูุณุณูุงุฑุงุชูุง</p>
                <p style="margin-top: 30px; font-size: 0.9em;">
                    ๐ง ุงูุจูุช ุฌุงูุฒ ูุงุณุชูุจุงู ุงูุฑุณุงุฆู ุนูู ุงููุงุชุณุงุจ
                </p>
            </div>
        </body>
    </html>
    """

if __name__ == '__main__':
    port = int(os.environ.get('PORT', 5000))
    app.run(host='0.0.0.0', port=port, debug=True)
