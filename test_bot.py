"""
ุณูุฑูุจุช ุงุฎุชุจุงุฑ ุงูุจูุช - ููุชุฃูุฏ ูู ุนูู ุฌููุน ุงููุธุงุฆู
Bot Testing Script - Verify all functions work correctly
"""

import sys
sys.path.append('.')

# ุงุณุชูุฑุงุฏ ุงููุธุงุฆู ูู ุงูุจูุช
from whatsapp_iphone_bot import (
    get_main_menu,
    show_iphones,
    show_iphone_details,
    show_accessories,
    show_contact_info,
    show_offers,
    process_order,
    handle_message,
    IPHONES,
    ACCESSORIES
)

def print_section(title):
    """ุทุจุงุนุฉ ุนููุงู ูุณู"""
    print("\n" + "="*60)
    print(f"  {title}")
    print("="*60 + "\n")

def test_main_menu():
    """ุงุฎุชุจุงุฑ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ"""
    print_section("๐งช ุงุฎุชุจุงุฑ 1: ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ")
    result = get_main_menu()
    print(result)
    print("\nโ ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ ุชุนูู ุจูุฌุงุญ!")

def test_show_iphones():
    """ุงุฎุชุจุงุฑ ุนุฑุถ ุงูุฃููููุงุช"""
    print_section("๐งช ุงุฎุชุจุงุฑ 2: ุนุฑุถ ูุงุฆูุฉ ุงูุฃููููุงุช")
    result = show_iphones()
    print(result)
    print("\nโ ุนุฑุถ ุงูุฃููููุงุช ูุนูู ุจูุฌุงุญ!")

def test_iphone_details():
    """ุงุฎุชุจุงุฑ ุนุฑุถ ุชูุงุตูู ุฃูููู"""
    print_section("๐งช ุงุฎุชุจุงุฑ 3: ุนุฑุถ ุชูุงุตูู iPhone 16 Pro Max")
    result = show_iphone_details('1')
    print(result)
    print("\nโ ุนุฑุถ ุงูุชูุงุตูู ูุนูู ุจูุฌุงุญ!")

def test_show_accessories():
    """ุงุฎุชุจุงุฑ ุนุฑุถ ุงูุงูุณุณูุงุฑุงุช"""
    print_section("๐งช ุงุฎุชุจุงุฑ 4: ุนุฑุถ ุงูุงูุณุณูุงุฑุงุช")
    result = show_accessories()
    print(result)
    print("\nโ ุนุฑุถ ุงูุงูุณุณูุงุฑุงุช ูุนูู ุจูุฌุงุญ!")

def test_contact_info():
    """ุงุฎุชุจุงุฑ ูุนูููุงุช ุงูุชูุงุตู"""
    print_section("๐งช ุงุฎุชุจุงุฑ 5: ูุนูููุงุช ุงูุชูุงุตู")
    result = show_contact_info()
    print(result)
    print("\nโ ูุนูููุงุช ุงูุชูุงุตู ุชุนูู ุจูุฌุงุญ!")

def test_offers():
    """ุงุฎุชุจุงุฑ ุงูุนุฑูุถ"""
    print_section("๐งช ุงุฎุชุจุงุฑ 6: ุงูุนุฑูุถ")
    result = show_offers()
    print(result)
    print("\nโ ุงูุนุฑูุถ ุชุนูู ุจูุฌุงุญ!")

def test_order():
    """ุงุฎุชุจุงุฑ ูุธุงู ุงูุทูุจุงุช"""
    print_section("๐งช ุงุฎุชุจุงุฑ 7: ูุธุงู ุงูุทูุจุงุช")
    result = process_order("ุทูุจ iPhone 16 Pro Max")
    print(result)
    print("\nโ ูุธุงู ุงูุทูุจุงุช ูุนูู ุจูุฌุงุญ!")

def test_message_handling():
    """ุงุฎุชุจุงุฑ ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ุงููุฎุชููุฉ"""
    print_section("๐งช ุงุฎุชุจุงุฑ 8: ูุนุงูุฌุฉ ุงูุฑุณุงุฆู")
    
    test_messages = [
        "ูุฑุญุจุง",
        "1",
        "ุงูููู",
        "ุงูุณุณูุงุฑ",
        "ุถูุงู",
        "ุชูุตูู",
        "ุนุฑูุถ",
        "ูููุน",
        "ุทูุจ",
        "ุงููุงุฆูุฉ"
    ]
    
    for msg in test_messages:
        print(f"\n๐จ ุฑุณุงูุฉ: '{msg}'")
        result = handle_message(msg)
        print(f"๐ค ุงูุฑุฏ: {result[:100]}...")  # ุฃูู 100 ุญุฑู ููุท
    
    print("\nโ ูุนุงูุฌุฉ ุงูุฑุณุงุฆู ุชุนูู ุจูุฌุงุญ!")

def test_data_integrity():
    """ุงุฎุชุจุงุฑ ุณูุงูุฉ ุงูุจูุงูุงุช"""
    print_section("๐งช ุงุฎุชุจุงุฑ 9: ุณูุงูุฉ ุงูุจูุงูุงุช")
    
    # ุงูุชุญูู ูู ุงูุฃููููุงุช
    print(f"โ ุนุฏุฏ ุงูุฃููููุงุช: {len(IPHONES)}")
    for key, iphone in IPHONES.items():
        assert 'name' in iphone, f"โ {key} ููุณ ูุฏูู ุงุณู"
        assert 'storage' in iphone, f"โ {key} ููุณ ูุฏูู ูุณุงุญุงุช ุชุฎุฒูู"
        assert 'colors' in iphone, f"โ {key} ููุณ ูุฏูู ุฃููุงู"
        assert 'features' in iphone, f"โ {key} ููุณ ูุฏูู ููุงุตูุงุช"
        
        # ุงูุชุญูู ูู ูุฌูุฏ ุฃุณุนุงุฑ
        has_price = any(k.startswith('price_') for k in iphone.keys())
        assert has_price, f"โ {key} ููุณ ูุฏูู ุฃุณุนุงุฑ"
    
    print("โ ุฌููุน ุจูุงูุงุช ุงูุฃููููุงุช ุตุญูุญุฉ!")
    
    # ุงูุชุญูู ูู ุงูุงูุณุณูุงุฑุงุช
    print(f"โ ุนุฏุฏ ุงูุงูุณุณูุงุฑุงุช: {len(ACCESSORIES)}")
    for key, acc in ACCESSORIES.items():
        assert 'name' in acc, f"โ {key} ููุณ ูุฏูู ุงุณู"
        assert 'price' in acc, f"โ {key} ููุณ ูุฏูู ุณุนุฑ"
        assert 'desc' in acc, f"โ {key} ููุณ ูุฏูู ูุตู"
    
    print("โ ุฌููุน ุจูุงูุงุช ุงูุงูุณุณูุงุฑุงุช ุตุญูุญุฉ!")

def test_price_formatting():
    """ุงุฎุชุจุงุฑ ุชูุณูู ุงูุฃุณุนุงุฑ"""
    print_section("๐งช ุงุฎุชุจุงุฑ 10: ุชูุณูู ุงูุฃุณุนุงุฑ")
    
    print("๐ฑ ุฃุณุนุงุฑ ุงูุฃููููุงุช:")
    for key, iphone in IPHONES.items():
        print(f"\n{iphone['name']}:")
        for k, v in iphone.items():
            if k.startswith('price_'):
                print(f"  - {k}: {v}")
                # ุงูุชุญูู ูู ุฃู ุงูุณุนุฑ ูุญุชูู ุนูู "ุฌููู"
                assert 'ุฌููู' in v, f"โ ุงูุณุนุฑ {v} ูุง ูุญุชูู ุนูู 'ุฌููู'"
    
    print("\n๐ง ุฃุณุนุงุฑ ุงูุงูุณุณูุงุฑุงุช:")
    for key, acc in ACCESSORIES.items():
        print(f"  - {acc['name']}: {acc['price']}")
        assert 'ุฌููู' in acc['price'], f"โ ุงูุณุนุฑ {acc['price']} ูุง ูุญุชูู ุนูู 'ุฌููู'"
    
    print("\nโ ุฌููุน ุงูุฃุณุนุงุฑ ููุณูุฉ ุจุดูู ุตุญูุญ!")

def run_all_tests():
    """ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช"""
    print("""
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                          โ
โ         ๐งช ุจุฏุก ุงุฎุชุจุงุฑ ุงูุจูุช ุงูุดุงูู                       โ
โ         ูุญู ุฃุญูุฏ ุงูุตุนูุฏู ููููุจุงููุงุช                     โ
โ                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    """)
    
    tests = [
        ("ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ", test_main_menu),
        ("ุนุฑุถ ุงูุฃููููุงุช", test_show_iphones),
        ("ุชูุงุตูู ุงูุฃูููู", test_iphone_details),
        ("ุนุฑุถ ุงูุงูุณุณูุงุฑุงุช", test_show_accessories),
        ("ูุนูููุงุช ุงูุชูุงุตู", test_contact_info),
        ("ุงูุนุฑูุถ", test_offers),
        ("ูุธุงู ุงูุทูุจุงุช", test_order),
        ("ูุนุงูุฌุฉ ุงูุฑุณุงุฆู", test_message_handling),
        ("ุณูุงูุฉ ุงูุจูุงูุงุช", test_data_integrity),
        ("ุชูุณูู ุงูุฃุณุนุงุฑ", test_price_formatting)
    ]
    
    passed = 0
    failed = 0
    
    for test_name, test_func in tests:
        try:
            test_func()
            passed += 1
        except Exception as e:
            print(f"\nโ ูุดู ุงุฎุชุจุงุฑ {test_name}: {str(e)}")
            failed += 1
    
    # ุงููุชูุฌุฉ ุงูููุงุฆูุฉ
    print("\n" + "="*60)
    print("๐ ูุชุงุฆุฌ ุงูุงุฎุชุจุงุฑ ุงูููุงุฆูุฉ")
    print("="*60)
    print(f"\nโ ุงุฎุชุจุงุฑุงุช ูุงุฌุญุฉ: {passed}")
    print(f"โ ุงุฎุชุจุงุฑุงุช ูุงุดูุฉ: {failed}")
    print(f"๐ ูุณุจุฉ ุงููุฌุงุญ: {(passed/(passed+failed)*100):.1f}%")
    
    if failed == 0:
        print("""
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                          โ
โ         ๐ ุชูุงูููุง! ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช                โ
โ         ุงูุจูุช ุฌุงูุฒ ููุงุณุชุฎุฏุงู                            โ
โ                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        """)
    else:
        print("""
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                          โ
โ         โ๏ธ  ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ูุดูุช                         โ
โ         ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุฃุฎุทุงุก ูุฅุตูุงุญูุง                    โ
โ                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        """)
    
    return failed == 0

if __name__ == "__main__":
    try:
        success = run_all_tests()
        sys.exit(0 if success else 1)
    except KeyboardInterrupt:
        print("\n\nโ๏ธ  ุชู ุฅููุงู ุงูุงุฎุชุจุงุฑ ุจูุงุณุทุฉ ุงููุณุชุฎุฏู")
        sys.exit(1)
    except Exception as e:
        print(f"\n\nโ ุฎุทุฃ ุบูุฑ ูุชููุน: {str(e)}")
        sys.exit(1)
